---
- name: 'Ensure PIP package installed'
  pip:
    name: 'shade'
    state: latest
    extra_args: -I
    virtualenv: .venv
    virtualenv_command: '/usr/bin/python3 -m venv'
  become: yes
  no_log: '{{ False if debug else True }}'
  tags: [os7, pip]

- when: os7_enabled
  block:
  - include_tasks: network.yml
    tags: [os7, network]
#TODO take image from Images or download new one
#  - include_tasks: image.yml
  - include_tasks: secgroup.yml
    tags: [os7, security]
  - include_tasks: sshkey.yml
    tags: [os7, sshkey]
  - include_tasks: deploy-masters.yml
    tags: [os7, deploy-masters]
  - include_tasks: deploy-slaves.yml
    tags: [os7, deploy-slaves]
  - include_tasks: destroy.yml
    tags: [os7, never, destroy]
  # block

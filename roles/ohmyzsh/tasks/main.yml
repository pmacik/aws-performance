---
- name: 'Ensure ZSH package installed'
  action: '{{ ansible_pkg_mgr }}'
  args:
    name: 'zsh'
    state: present
  become: yes
  tags: [ohmyzsh, install]

- name: Clone oh-my-zsh repo
  git:
    repo: git://github.com/robbyrussell/oh-my-zsh.git
    dest: '{{ tools_owner_home }}/.oh-my-zsh'
  become_user: '{{ tools_owner_name }}'
  become: yes
  tags: [ohmyzsh, install]

- name: Create a new zsh config
  copy:
    src: '{{ tools_owner_home }}/.oh-my-zsh/templates/zshrc.zsh-template'
    dest: '{{ tools_owner_home }}/.zshrc'
    remote_src: yes
  become_user: '{{ tools_owner_name }}'
  become: yes
  tags: [ohmyzsh, config]

- name: Set zsh as default shell
  user:
    name: '{{ tools_owner_name }}'
    shell: /usr/bin/zsh
  become: yes
  tags: [ohmyzsh, config]